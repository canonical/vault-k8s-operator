[32mINFO    [0m juju.model:model.py:3211 Waiting for model:
  vault-b/0 [idle] active: 
  vault-b/2 [idle] active: 
  vault-b/1 [idle] active: 
[32mINFO    [0m juju.model:model.py:3211 Waiting for model:
  vault-b/0 [idle] active: 
  vault-b/2 [idle] active: 
  vault-b/1 [idle] active:
[32mINFO    [0m pytest_operator.plugin:plugin.py:929 Model status:

Model                  Controller                Cloud/Region        Version  SLA          Timestamp
test-integration-8aer  github-pr-49adf-microk8s  microk8s/localhost  3.6.1    unsupported  13:29:07Z

App        Version  Status  Scale  Charm      Channel  Rev  Address         Exposed  Message
vault-b             active      3  vault-k8s             1  10.152.183.211  no       
vault-k8s           active      3  vault-k8s             0  10.152.183.34   no       

Unit          Workload  Agent      Address     Ports  Message
vault-b/0*    active    executing  10.1.53.13         
vault-b/1     active    executing  10.1.53.4          
vault-b/2     active    executing  10.1.53.10         
vault-k8s/0*  active    executing  10.1.53.17         
vault-k8s/1   active    executing  10.1.53.25         
vault-k8s/2   active    executing  10.1.53.23         

[32mINFO    [0m pytest_operator.plugin:plugin.py:935 Juju error logs:

unit-vault-k8s-1: 13:06:11 ERROR unit.vault-k8s/1.juju-log [vault_client] Error while checking Vault health status: HTTPSConnectionPool(host='vault-k8s-1.vault-k8s-endpoints.test-integration-8aer.svc.cluster.local', port=8200): Max retries exceeded with url: /v1/sys/health (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7258c67a7610>: Failed to establish a new connection: [Errno 111] Connection refused'))
unit-loki-k8s-0: 13:19:31 ERROR unit.loki-k8s/0.juju-log Uncaught exception while in charm code:
Traceback (most recent call last):
  File "./src/charm.py", line 833, in <module>
    main(LokiOperatorCharm)
  File "/var/lib/juju/agents/unit-loki-k8s-0/charm/venv/ops/main.py", line 45, in main
    return _main.main(charm_class=charm_class, use_juju_for_storage=use_juju_for_storage)
  File "/var/lib/juju/agents/unit-loki-k8s-0/charm/venv/ops/_main.py", line 543, in main
    manager.run()
  File "/var/lib/juju/agents/unit-loki-k8s-0/charm/venv/ops/_main.py", line 529, in run
    self._emit()
  File "/var/lib/juju/agents/unit-loki-k8s-0/charm/venv/ops/_main.py", line 518, in _emit
    _emit_charm_event(self.charm, self.dispatcher.event_name, self._juju_context)
  File "/var/lib/juju/agents/unit-loki-k8s-0/charm/venv/ops/_main.py", line 134, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-loki-k8s-0/charm/venv/ops/framework.py", line 347, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-loki-k8s-0/charm/venv/ops/framework.py", line 857, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-loki-k8s-0/charm/venv/ops/framework.py", line 947, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-loki-k8s-0/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 1064, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
  File "./src/charm.py", line 281, in _on_node_exporter_pebble_ready
    self._node_exporter_container.add_layer("node-exporter", new_layer, combine=True)
  File "/var/lib/juju/agents/unit-loki-k8s-0/charm/venv/ops/model.py", line 2438, in add_layer
    self._pebble.add_layer(label, layer, combine=combine)
  File "/var/lib/juju/agents/unit-loki-k8s-0/charm/venv/ops/pebble.py", line 2367, in add_layer
    self._request('POST', '/v1/layers', body=body)
  File "/var/lib/juju/agents/unit-loki-k8s-0/charm/venv/ops/pebble.py", line 2010, in _request
    response = self._request_raw(method, path, query, headers, data)
  File "/var/lib/juju/agents/unit-loki-k8s-0/charm/venv/ops/pebble.py", line 2063, in _request_raw
    raise ConnectionError(
ops.pebble.ConnectionError: Could not connect to Pebble: socket not found at '/charm/containers/node-exporter/pebble.socket' (container restarted?)
unit-loki-k8s-0: 13:19:32 ERROR juju.worker.uniter.operation hook "node-exporter-pebble-ready" (via hook dispatching script: dispatch) failed: exit status 1
unit-loki-k8s-0: 13:19:32 ERROR juju.worker.uniter pebble poll failed for container "node-exporter": failed to send pebble-ready event: hook failed
controller-0: 13:23:20 ERROR juju.worker.caasunitprovisioner stopping application worker for minio: Operation cannot be fulfilled on statefulsets.apps "minio": StorageError: invalid object, Code: 4, Key: /registry/statefulsets/test-integration-8aer/minio, ResourceVersion: 0, AdditionalErrorMsg: Precondition failed: UID in precondition: beafbd74-de65-44da-baca-4e9e33cb1f71, UID in object meta: 
unit-vault-b-2: 13:27:05 ERROR unit.vault-b/2.juju-log vault-autounseal-requires:13: Raft cluster is not healthy. {'failure_tolerance': 0, 'healthy': False, 'leader': 'test-integration-8aer-vault-b/0', 'servers': {'test-integration-8aer-vault-b/0': {'id': 'test-integration-8aer-vault-b/0', 'name': 'test-integration-8aer-vault-b/0', 'address': 'vault-b-0.vault-b-endpoints.test-integration-8aer.svc.cluster.local:8201', 'node_status': 'alive', 'last_contact': '0s', 'last_term': 3, 'last_index': 102, 'healthy': True, 'stable_since': '2025-01-20T13:25:01.206387766Z', 'status': 'leader', 'version': '1.16.3', 'node_type': 'voter'}, 'test-integration-8aer-vault-b/1': {'id': 'test-integration-8aer-vault-b/1', 'name': 'test-integration-8aer-vault-b/1', 'address': 'vault-b-1.vault-b-endpoints.test-integration-8aer.svc.cluster.local:8201', 'node_status': 'alive', 'last_contact': '4.08668692s', 'last_term': 0, 'last_index': 0, 'healthy': False, 'stable_since': '2025-01-20T13:27:01.207239027Z', 'status': 'non-voter', 'version': '1.16.3', 'node_type': 'voter'}, 'test-integration-8aer-vault-b/2': {'id': 'test-integration-8aer-vault-b/2', 'name': 'test-integration-8aer-vault-b/2', 'address': 'vault-b-2.vault-b-endpoints.test-integration-8aer.svc.cluster.local:8201', 'node_status': 'alive', 'last_contact': '1.586420891s', 'last_term': 3, 'last_index': 99, 'healthy': True, 'stable_since': '2025-01-20T13:26:59.207460364Z', 'status': 'non-voter', 'version': '1.16.3', 'node_type': 'voter'}}, 'voters': ['test-integration-8aer-vault-b/0']}
unit-vault-b-0: 13:27:34 ERROR unit.vault-b/0.juju-log [vault_client] Error while checking Vault health status: HTTPSConnectionPool(host='vault-b-0.vault-b-endpoints.test-integration-8aer.svc.cluster.local', port=8200): Max retries exceeded with url: /v1/sys/health (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7c0868d26e60>: Failed to establish a new connection: [Errno 111] Connection refused'))
unit-vault-b-2: 13:28:15 ERROR unit.vault-b/2.juju-log [vault_client] Error while checking Vault health status: HTTPSConnectionPool(host='vault-b-2.vault-b-endpoints.test-integration-8aer.svc.cluster.local', port=8200): Max retries exceeded with url: /v1/sys/health (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x740a90a6c5e0>: Failed to establish a new connection: [Errno 111] Connection refused'))
unit-vault-b-1: 13:28:15 ERROR unit.vault-b/1.juju-log [vault_client] Error while checking Vault health status: HTTPSConnectionPool(host='vault-b-1.vault-b-endpoints.test-integration-8aer.svc.cluster.local', port=8200): Max retries exceeded with url: /v1/sys/health (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7affba02b640>: Failed to establish a new connection: [Errno 111] Connection refused'))
unit-vault-b-0: 13:28:17 ERROR unit.vault-b/0.juju-log [vault_client] Error while checking Vault health status: HTTPSConnectionPool(host='vault-b-0.vault-b-endpoints.test-integration-8aer.svc.cluster.local', port=8200): Max retries exceeded with url: /v1/sys/health (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7c385ef2ef80>: Failed to establish a new connection: [Errno 111] Connection refused'))
unit-vault-b-0: 13:28:36 ERROR unit.vault-b/0.juju-log Raft cluster is not healthy. {'failure_tolerance': 0, 'healthy': False, 'leader': 'test-integration-8aer-vault-b/0', 'servers': {'test-integration-8aer-vault-b/0': {'id': 'test-integration-8aer-vault-b/0', 'name': 'test-integration-8aer-vault-b/0', 'address': 'vault-b-0.vault-b-endpoints.test-integration-8aer.svc.cluster.local:8201', 'node_status': 'alive', 'last_contact': '0s', 'last_term': 4, 'last_index': 248, 'healthy': True, 'stable_since': '2025-01-20T13:28:35.382421507Z', 'status': 'leader', 'version': '1.16.3', 'node_type': 'voter'}, 'test-integration-8aer-vault-b/1': {'id': 'test-integration-8aer-vault-b/1', 'name': 'test-integration-8aer-vault-b/1', 'address': 'vault-b-1.vault-b-endpoints.test-integration-8aer.svc.cluster.local:8201', 'node_status': 'alive', 'last_contact': '5.13009ms', 'last_term': 0, 'last_index': 0, 'healthy': False, 'stable_since': '2025-01-20T13:28:35.382421507Z', 'status': 'voter', 'version': '1.16.3', 'node_type': 'voter'}, 'test-integration-8aer-vault-b/2': {'id': 'test-integration-8aer-vault-b/2', 'name': 'test-integration-8aer-vault-b/2', 'address': 'vault-b-2.vault-b-endpoints.test-integration-8aer.svc.cluster.local:8201', 'node_status': 'alive', 'last_contact': '5.13049ms', 'last_term': 0, 'last_index': 0, 'healthy': False, 'stable_since': '2025-01-20T13:28:35.382421507Z', 'status': 'voter', 'version': '1.16.3', 'node_type': 'voter'}}, 'voters': ['test-integration-8aer-vault-b/0', 'test-integration-8aer-vault-b/1', 'test-integration-8aer-vault-b/2']}

[32mINFO    [0m pytest_operator.plugin:plugin.py:1041 Resetting model test-integration-8aer...
[32mINFO    [0m pytest_operator.plugin:plugin.py:1030    Destroying applications vault-k8s
[32mINFO    [0m pytest_operator.plugin:plugin.py:1030    Destroying applications vault-b
[32mINFO    [0m pytest_operator.plugin:plugin.py:1046 Not waiting on reset to complete.
[32mINFO    [0m pytest_operator.plugin:plugin.py:1017 Forgetting model main...