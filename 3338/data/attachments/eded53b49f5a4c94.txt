[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  vault-k8s/0 [executing] active: 
  vault-k8s/1 [executing] active: 
  vault-k8s/2 [executing] active: 
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  tls-certificates-requirer/0 [executing] active: Certificate relation is created
[32mINFO    [0m pytest_operator.plugin:plugin.py:937 Model status:

Model          Controller                Cloud/Region        Version  SLA          Timestamp
test-pki-8vd9  github-pr-69651-microk8s  microk8s/localhost  3.6.8    unsupported  15:12:52Z

App                        Version  Status  Scale  Charm                      Channel        Rev  Address         Exposed  Message
self-signed-certificates            active      1  self-signed-certificates   1/stable       317  10.152.183.49   no       
tls-certificates-requirer           active      1  tls-certificates-requirer  latest/stable   93  10.152.183.19   no       Unit certificate is available
vault-k8s                           active      3  vault-k8s                                   0  10.152.183.127  no       

Unit                          Workload  Agent  Address      Ports  Message
self-signed-certificates/0*   active    idle   10.1.63.217         
tls-certificates-requirer/0*  active    idle   10.1.63.218         Unit certificate is available
vault-k8s/0*                  active    idle   10.1.63.208         
vault-k8s/1                   active    idle   10.1.63.215         
vault-k8s/2                   active    idle   10.1.63.216         

[32mINFO    [0m pytest_operator.plugin:plugin.py:943 Juju error logs:

unit-vault-k8s-1: 15:10:09 ERROR unit.vault-k8s/1.juju-log [vault_client] Error while checking Vault health status: HTTPSConnectionPool(host='vault-k8s-1.vault-k8s-endpoints.test-pki-8vd9.svc.cluster.local', port=8200): Max retries exceeded with url: /v1/sys/health (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f29eba6b230>: Failed to establish a new connection: [Errno 111] Connection refused'))
unit-vault-k8s-1: 15:10:11 ERROR unit.vault-k8s/1.juju-log [vault_client] Error while checking Vault health status: HTTPSConnectionPool(host='vault-k8s-1.vault-k8s-endpoints.test-pki-8vd9.svc.cluster.local', port=8200): Max retries exceeded with url: /v1/sys/health (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f9b27142ea0>: Failed to establish a new connection: [Errno 111] Connection refused'))
unit-vault-k8s-2: 15:10:11 ERROR unit.vault-k8s/2.juju-log [vault_client] Error while checking Vault health status: HTTPSConnectionPool(host='vault-k8s-2.vault-k8s-endpoints.test-pki-8vd9.svc.cluster.local', port=8200): Max retries exceeded with url: /v1/sys/health (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f767f357380>: Failed to establish a new connection: [Errno 111] Connection refused'))
unit-vault-k8s-1: 15:10:12 ERROR unit.vault-k8s/1.juju-log vault-peers:0: [vault_client] Error while checking Vault health status: HTTPSConnectionPool(host='vault-k8s-1.vault-k8s-endpoints.test-pki-8vd9.svc.cluster.local', port=8200): Max retries exceeded with url: /v1/sys/health (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f17ead3b110>: Failed to establish a new connection: [Errno 111] Connection refused'))
unit-vault-k8s-2: 15:10:12 ERROR unit.vault-k8s/2.juju-log [vault_client] Error while checking Vault health status: HTTPSConnectionPool(host='vault-k8s-2.vault-k8s-endpoints.test-pki-8vd9.svc.cluster.local', port=8200): Max retries exceeded with url: /v1/sys/health (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f76b98eb2c0>: Failed to establish a new connection: [Errno 111] Connection refused'))
unit-vault-k8s-2: 15:10:14 ERROR unit.vault-k8s/2.juju-log vault-peers:0: [vault_client] Error while checking Vault health status: HTTPSConnectionPool(host='vault-k8s-2.vault-k8s-endpoints.test-pki-8vd9.svc.cluster.local', port=8200): Max retries exceeded with url: /v1/sys/health (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f9838eeb0e0>: Failed to establish a new connection: [Errno 111] Connection refused'))
controller-0: 15:10:25 ERROR juju.worker.caasapplicationprovisioner.runner exited "tls-certificates-requirer": more than 20 retries ensuring scale: setting scale to 1 for "tls-certificates-requirer": statefulset "tls-certificates-requirer" not found
controller-0: 15:10:25 ERROR juju.worker.caasapplicationprovisioner.runner exited "self-signed-certificates": more than 20 retries ensuring trust: updating application "self-signed-certificates" to desired trust false: getting service account role "self-signed-certificates": k8s: roles.rbac.authorization.k8s.io "self-signed-certificates" not found
unit-self-signed-certificates-0: 15:11:56 ERROR unit.self-signed-certificates/0.juju-log At least 1 matching relation ID not found with the relation name 'send-ca-cert'
unit-self-signed-certificates-0: 15:12:04 ERROR unit.self-signed-certificates/0.juju-log certificates:1: At least 1 matching relation ID not found with the relation name 'send-ca-cert'
unit-self-signed-certificates-0: 15:12:06 ERROR unit.self-signed-certificates/0.juju-log certificates:1: At least 1 matching relation ID not found with the relation name 'send-ca-cert'
unit-self-signed-certificates-0: 15:12:09 ERROR unit.self-signed-certificates/0.juju-log certificates:1: At least 1 matching relation ID not found with the relation name 'send-ca-cert'
unit-self-signed-certificates-0: 15:12:12 ERROR unit.self-signed-certificates/0.juju-log certificates:1: At least 1 matching relation ID not found with the relation name 'send-ca-cert'
unit-self-signed-certificates-0: 15:12:21 ERROR unit.self-signed-certificates/0.juju-log At least 1 matching relation ID not found with the relation name 'send-ca-cert'
unit-self-signed-certificates-0: 15:12:44 ERROR unit.self-signed-certificates/0.juju-log certificates:1: At least 1 matching relation ID not found with the relation name 'send-ca-cert'

[32mINFO    [0m pytest_operator.plugin:plugin.py:1049 Resetting model test-pki-8vd9...
[32mINFO    [0m pytest_operator.plugin:plugin.py:1038    Destroying applications vault-k8s
[32mINFO    [0m pytest_operator.plugin:plugin.py:1038    Destroying applications self-signed-certificates
[32mINFO    [0m pytest_operator.plugin:plugin.py:1038    Destroying applications tls-certificates-requirer
[32mINFO    [0m pytest_operator.plugin:plugin.py:1054 Not waiting on reset to complete.
[32mINFO    [0m pytest_operator.plugin:plugin.py:1025 Forgetting model main...
[33mWARNING [0m juju.client.connection:connection.py:579 RPC: Connection closed, reconnecting
[33mWARNING [0m juju.client.connection:connection.py:579 RPC: Connection closed, reconnecting
[33mWARNING [0m juju.client.connection:connection.py:579 RPC: Connection closed, reconnecting
[1m[31mERROR   [0m juju.client.connection:connection.py:587 RPC: Automatic reconnect failed
[1m[31mERROR   [0m juju.client.connection:connection.py:587 RPC: Automatic reconnect failed
[1m[31mERROR   [0m juju.client.connection:connection.py:587 RPC: Automatic reconnect failed
[1m[31mERROR   [0m asyncio:base_events.py:1821 _GatheringFuture exception was never retrieved
future: <_GatheringFuture finished exception=ConnectionClosedOK(Close(code=1000, reason=''), Close(code=1000, reason=''), False)>
Traceback (most recent call last):
  File "/home/runner/work/vault-k8s-operator/vault-k8s-operator/k8s/.tox/integration/lib/python3.12/site-packages/juju/model/__init__.py", line 3162, in wait_for_idle
    app_status = await app.get_status()
                 ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/vault-k8s-operator/vault-k8s-operator/k8s/.tox/integration/lib/python3.12/site-packages/juju/application.py", line 559, in get_status
    full_status = await client_facade.FullStatus(patterns=None)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/vault-k8s-operator/vault-k8s-operator/k8s/.tox/integration/lib/python3.12/site-packages/juju/client/facade.py", line 482, in wrapper
    reply = await f(*args, **kwargs)
            ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/vault-k8s-operator/vault-k8s-operator/k8s/.tox/integration/lib/python3.12/site-packages/juju/client/_client8.py", line 35, in FullStatus
    reply = await self.rpc(msg)
            ^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/vault-k8s-operator/vault-k8s-operator/k8s/.tox/integration/lib/python3.12/site-packages/juju/client/facade.py", line 680, in rpc
    result = await self.connection.rpc(msg, encoder=TypeEncoder)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/vault-k8s-operator/vault-k8s-operator/k8s/.tox/integration/lib/python3.12/site-packages/juju/client/connection.py", line 574, in rpc
    await self._ws.send(outgoing)
  File "/home/runner/work/vault-k8s-operator/vault-k8s-operator/k8s/.tox/integration/lib/python3.12/site-packages/websockets/asyncio/connection.py", line 476, in send
    async with self.send_context():
  File "/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/vault-k8s-operator/vault-k8s-operator/k8s/.tox/integration/lib/python3.12/site-packages/websockets/asyncio/connection.py", line 957, in send_context
    raise self.protocol.close_exc from original_exc
websockets.exceptions.ConnectionClosedOK: sent 1000 (OK); then received 1000 (OK)